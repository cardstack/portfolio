{{!-- When the session does not exist then the error card takes over and renders the login form --}}

{{!-- fastboot guard --}}
{{#if (is-component "cardstack-session")}}
  {{#cardstack-session as |session|}}
    {{#if session.isAuthenticated}}
      <div class="user-isolated">
        <h1 class="user-isolated__title">Profile</h1>
        {{#if updateSuccessful}}
          <p class="user-isolated__success" data-test-user-update-success>
            User profile has been updated.
          </p>
        {{else if formError}}
          <p class="user-isolated__error" data-test-user-update-error>{{formError}}</p>
        {{/if}}

        <form onsubmit={{action submitForm}} class="user-isolated__form" data-test-user-form>
          <div class="user-isolated__form-row">
            <label>
              {{#if editName}}
                <span class="user-isolated__label">Name</span>
                <input
                  type="text"
                  placeholder="Full name"
                  value={{name}}
                  oninput={{action doOnInput 'name'}}
                  class="user-isolated__input"
                  data-test-user-name
                  />
              {{else}}
                <span class="user-isolated__user-info" data-test-user-name-display>{{name}}</span>
                <button {{action editField 'editName'}} data-test-user-name-edit-button>Edit</button>
              {{/if}}
            </label>
          </div>

          <div class="user-isolated__form-row">
            <label>
              <span class="user-isolated__label">Email</span>
              {{#if editEmail}}
                <input
                  type="email"
                  placeholder="hello@cardstack.com"
                  value={{email}}
                  oninput={{action doOnInput 'email'}}
                  class="user-isolated__input"
                  data-test-user-email
                  />
              {{else}}
                <span class="user-isolated__user-info" data-test-user-email-display>{{email}}</span>
                <button {{action editField 'editEmail'}} data-test-user-email-edit-button>Edit</button>
              {{/if}}
            </label>
          </div>

          <div class="user-isolated__form-row">
            <label>
              {{#if editPassword}}
                <span class="user-isolated__label">Current Password</span>
                <input
                    type="password"
                    value={{currentPassword}}
                    oninput={{action doOnInput 'currentPassword'}}
                    class="user-isolated__input"
                    data-test-user-current-password
                    />
              {{else}}
                <span class="user-isolated__label">Password</span>
                <span class="user-isolated__user-info">********</span>
                <button {{action editField 'editPassword'}} data-test-user-password-edit-button>Edit</button>
              {{/if}}
            </label>
          </div>
          {{#if editPassword}}
            <div class="user-isolated__form-row">
              <label>
                <span class="user-isolated__label">New Password (minimum 8 characters)</span>
                <input
                    type="password"
                    value={{newPassword}}
                    oninput={{action doOnInput 'newPassword'}}
                    class="user-isolated__input"
                    data-test-user-new-password
                    />
              </label>
            </div>
            <div class="user-isolated__form-row">
              <label>
                <span class="user-isolated__label">Confirm New Password:</span>
                <input
                    type="password"
                    value={{confirmNewPassword}}
                    oninput={{action doOnInput 'confirmNewPassword'}}
                    class="user-isolated__input"
                    data-test-user-confirm-new-password
                    />
              </label>
            </div>
          {{/if}}

          {{#if isEditable}}
            <div class="user-isolated__button-row">
              <button
                type="submit"
                class="user-isolated__button {{if (not formCanBeSubmitted) "disabled"}}"
                disabled={{not formCanBeSubmitted}}
                data-test-user-submit
              >
                Update
              </button>
              <button
                class="user-isolated__button user-isolated__button--cancel"
                {{action resetForm}}
                data-test-user-reset
              >
                Cancel
              </button>
            </div>
          {{/if}}
        </form>
      </div>
    {{/if}}
  {{/cardstack-session}}
{{/if}}
